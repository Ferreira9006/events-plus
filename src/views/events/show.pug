extends ../layouts/app

block content
  section(class="max-w-6xl mx-auto px-4 pt-10 pb-12 space-y-8")

    // Cabeçalho
    div(class="flex items-start justify-between gap-4")
      div
        h1(class="text-2xl font-extrabold text-slate-900 leading-tight")
          | #{event.title}
        if event.location
          p(class="text-slate-500 mt-1")
            | #{event.location}
      a(
        href="/events"
        class="text-sm font-semibold text-slate-500 hover:text-slate-700 hover:underline"
      ) Voltar à lista

    // If the user is owner of the event, display edit/delete options
    if isOwner
      div(class="bg-white rounded-2xl border border-slate-200 p-6 shadow-sm space-y-4")   
        div(class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4")
          p(class="text-sm text-slate-500") És o organizador deste evento. Podes editar ou eliminar o evento abaixo.
          div(class="flex items-center gap-4")
            a(
              href=`/events/${event._id}/edit`
              class="inline-flex items-center justify-center px-4 py-2 rounded-xl text-sm font-semibold bg-slate-100 text-slate-700 hover:bg-slate-200"
            ) Editar evento
            form(method="post" action=`/events/${event._id}/delete` onsubmit="return confirm('Tens a certeza que queres eliminar este evento? Esta ação não pode ser desfeita.');")
              button(
                type="submit"
                class="inline-flex items-center justify-center px-4 py-2 rounded-xl text-sm font-semibold bg-rose-600 text-white hover:bg-rose-700"
              ) Eliminar evento

    // Card principal com info do evento
    div(class="grid grid-cols-1 lg:grid-cols-[1.7fr,1.3fr] gap-6 items-start")

      // Coluna esquerda: descrição + info
      article(class="bg-white rounded-2xl border border-slate-200 p-6 shadow-sm space-y-4")
        if event.status
          - let statusClass = 'bg-slate-100 text-slate-700';
          if event.status === 'OPEN'
            - statusClass = 'bg-emerald-50 text-emerald-700';
          else if event.status === 'FULL'
            - statusClass = 'bg-amber-50 text-amber-700';
          else if event.status === 'CANCELLED'
            - statusClass = 'bg-rose-50 text-rose-700';
          else if event.status === 'FINISHED'
            - statusClass = 'bg-slate-200 text-slate-800';

          span(
            class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold " + statusClass
          ) #{event.status}

        if event.description
          p(class="text-sm text-slate-700 mt-3 whitespace-pre-line")
            | #{event.description}

        dl(class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-slate-600")
          if event.date
            div
              dt(class="text-xs font-semibold uppercase tracking-wide text-slate-400") Data
              dd(class="mt-1") #{event.date}
          if event.time
            div
              dt(class="text-xs font-semibold uppercase tracking-wide text-slate-400") Hora
              dd(class="mt-1") #{event.time}
          if event.location
            div
              dt(class="text-xs font-semibold uppercase tracking-wide text-slate-400") Local
              dd(class="mt-1") #{event.location}
          if event.organizer
            div
              dt(class="text-xs font-semibold uppercase tracking-wide text-slate-400") Organizador
              dd(class="mt-1")
                | #{event.organizer.name || 'Utilizador'}
                if event.organizer.email
                  span(class="text-slate-400 text-xs")  · #{event.organizer.email}

      // Coluna direita: capacidade + participação
      aside(class="space-y-4")

        // Capacidade
        - let participantCount = (event.participants && event.participants.length) ? event.participants.length : 0;

        div(class="bg-white rounded-2xl border border-slate-200 p-5 shadow-sm space-y-3")
          h2(class="text-sm font-semibold text-slate-800 uppercase tracking-wide")
            | Participação
          p(class="text-sm text-slate-600")
            | Lugares: 
            span(class="font-semibold text-slate-900") #{participantCount}
            if typeof event.capacity !== 'undefined'
              |  / #{event.capacity}

          if event.status === 'OPEN'
            if user
              if isParticipant
                form(method="post" action=`/events/${event._id}/leave`)
                  button(
                    type="submit"
                    class="w-full px-4 py-2 rounded-xl text-sm font-semibold bg-rose-600 text-white hover:bg-rose-700"
                  )
                    | Remover inscrição
              else if event.status === 'OPEN'
                form(method="post" action=`/events/${event._id}/participate`)
                  button(
                    type="submit"
                    class="w-full px-4 py-2 rounded-xl text-sm font-semibold bg-emerald-600 text-white hover:bg-emerald-700"
                  )
                    | Inscrever-me
            else
              p(class="text-sm text-slate-500 italic")
                | Inicia sessão para te inscreveres neste evento.
          else
            p(class="text-xs text-slate-400 italic mt-2")
              | Participações indisponíveis para este evento.

        // Lista de participantes
        div(class="bg-white rounded-2xl border border-slate-200 p-5 shadow-sm space-y-3")
          h2(class="text-sm font-semibold text-slate-800 uppercase tracking-wide")
            | Participantes
          if !event.participants || event.participants.length === 0
            p(class="text-sm text-slate-500")
              | Ainda não há participantes neste evento.
          else
            ul(class="space-y-2 text-sm text-slate-700")
              each participant in event.participants
                li(class="flex items-center justify-between gap-2")
                  span #{participant.name || 'Utilizador'}
                  if participant.email
                    span(class="text-xs text-slate-400") #{participant.email}
